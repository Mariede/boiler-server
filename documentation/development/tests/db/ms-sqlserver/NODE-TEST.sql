USE [NODE_TEST]
GO
/****** Object:  Table [dbo].[PERFIL]    Script Date: 08/09/2020 14:54:52 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PERFIL]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PERFIL](
	[ID_PERFIL] [int] NOT NULL,
	[PERFIL] [varchar](50) NOT NULL,
 CONSTRAINT [PK_PERFIL] PRIMARY KEY CLUSTERED
(
	[ID_PERFIL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[PERFIL_USUARIO]    Script Date: 08/09/2020 14:54:52 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[PERFIL_USUARIO]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[PERFIL_USUARIO](
	[ID_PERFIL] [int] NOT NULL,
	[ID_USUARIO] [int] NOT NULL,
 CONSTRAINT [PK_PERFIL_USUARIO] PRIMARY KEY CLUSTERED
(
	[ID_PERFIL] ASC,
	[ID_USUARIO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[TIPO]    Script Date: 08/09/2020 14:54:52 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TIPO]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[TIPO](
	[ID_TIPO] [int] NOT NULL,
	[TIPO] [varchar](50) NOT NULL,
 CONSTRAINT [PK_TIPO] PRIMARY KEY CLUSTERED
(
	[ID_TIPO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
/****** Object:  Table [dbo].[USUARIO]    Script Date: 08/09/2020 14:54:52 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[USUARIO]') AND type in (N'U'))
BEGIN
CREATE TABLE [dbo].[USUARIO](
	[ID_USUARIO] [int] IDENTITY(1,1) NOT NULL,
	[ID_TIPO] [int] NOT NULL,
	[NOME] [varchar](200) NOT NULL,
	[EMAIL] [varchar](200) NOT NULL,
	[SENHA] [varchar](128) NOT NULL,
	[SALT] [varchar](5) NOT NULL,
	[ATIVO] [bit] NOT NULL,
 CONSTRAINT [PK_USUARIO] PRIMARY KEY CLUSTERED
(
	[ID_USUARIO] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
) ON [PRIMARY]
END
GO
INSERT [dbo].[PERFIL] ([ID_PERFIL], [PERFIL]) VALUES (1, N'PERFIL 1')
INSERT [dbo].[PERFIL] ([ID_PERFIL], [PERFIL]) VALUES (2, N'PERFIL 2')
INSERT [dbo].[PERFIL] ([ID_PERFIL], [PERFIL]) VALUES (3, N'PERFIL 3')
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (1, 1)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (1, 2)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (1, 3)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (1, 8)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (1, 40)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (1, 93)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (2, 1)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (2, 68)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (2, 69)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (2, 70)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (2, 93)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (3, 76)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (3, 77)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (3, 78)
INSERT [dbo].[PERFIL_USUARIO] ([ID_PERFIL], [ID_USUARIO]) VALUES (3, 93)
INSERT [dbo].[TIPO] ([ID_TIPO], [TIPO]) VALUES (1, N'ALPHA')
INSERT [dbo].[TIPO] ([ID_TIPO], [TIPO]) VALUES (2, N'BETA')
INSERT [dbo].[TIPO] ([ID_TIPO], [TIPO]) VALUES (3, N'GAMA')
INSERT [dbo].[TIPO] ([ID_TIPO], [TIPO]) VALUES (4, N'DELTA')
INSERT [dbo].[TIPO] ([ID_TIPO], [TIPO]) VALUES (5, N'EPSILON')
SET IDENTITY_INSERT [dbo].[USUARIO] ON

INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (1, 2, N'Joaquim Santos', N'jsantos@email.com', N'0970d5775cebc72f1fefb69a1eb8a2d98d9c7fcdbb1378e040be8cf25246aeccbf3f5ab07f2bd5801040595dd38454f609015251678822bb649c7352109af7ff', N'62077', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (2, 2, N'Marcio Araújo', N'maraujo@email.com', N'8d45da886663570f9eae356788ae02ac5edbd9a0cfdad870a7015924361f3f7c3773bb500e47f3ec16d0bc7e8a3bf7d4386c0ef2c77fedff666f8ed1ed84582f', N'44043', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (3, 5, N'Enéias Carneiro', N'eneias@email2.com', N'a8d38252958ba2c179a72c89af577e9abdd050ba9ea3a697e009c513c6ee72c6892b55e966536055012acb89dc68fc41cf1b1bd0d4aee9cb07385c19fca071db', N'd808b', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (8, 1, N'Eleonora Paschoal dos Santos', N'eleonora.paschoal@email.com', N'7c1f069ac995851131301a399c0142e91aed5a459c246bc29bd4c9e0ee53b65675d8cf5596e83070885ca558f68ae02710cb2cd4196d90a6b7e30d7b99fc3208', N'ca254', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (40, 5, N'Élison gustavo', N'elison@email23.com', N'e14987ed5cc23cdb56e33c75fcc07860776752b285e51dc319a3afc4ceabdf71d16d72b393400409c2a3965a7bfb41b0a296d00d181a0f63723b9555d7c0378f', N'22032', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (68, 2, N'Jonny, o desordeiro', N'jonny@destructor.com', N'8fd4a81099464baa6ff62836e19f60619d1bafd1a991d3f62beab96d95ed2c0e8daeb47a509d4db18b62e05441d8abbaa21865c8824210cff296318fdc01c849', N'ff990', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (69, 2, N'Acácio da Silva Calegário', N'acacio@email.com', N'3d4cb39f83fac6b3da983d43c55cca212007a8d5fcf10c3d0c6575293b7222e350909a52e0a29458947a1e930b9c917c4f342b94d82151bfdc5833c1fa55abf5', N'5243e', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (70, 2, N'Yonara Magalhães Mendonça', N'yonara@email.com', N'3031d688d667887ca91f2b852ecb1c9c126aee6fed63258aca49b1e15eebd972b62666801d15d8412d4ee508a579c62fb3e52f2ede655856f3a2bb5388e40633', N'f681b', 0)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (76, 3, N'Yuna Siqueira', N'yuna.siqueira@email.com', N'3a38d60ec01d9c38058aada982a126ba62c3f736c104a232a9598d0a78ce34d8682b626eb697de58d93c50faddec8e7887fbb86f40e832042d629fd6ab05060d', N'e0aa7', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (77, 4, N'Joffrey Baratheon Magalhães Inácio', N'joffrey@email.com', N'65e9dc99c0fdecfa9326499d6fe3c4674a0c402c8f4c3843f0e5b0544e789bb3d48c20f561df5de0bda96b79cb9e79e649299bf3f26d37fad3cb409d2498520d', N'0361f', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (78, 1, N'Cacique Raoní', N'cacique.raoni@emailfloresta.com', N'fad725c64711f559aa7df479907d92bab158ccf15f6820ac86f689673058e683e884e47dc3cddbefc2eb14128cfb0224ee4c2d1eb67b770abee7b637288af868', N'72190', 1)
INSERT [dbo].[USUARIO] ([ID_USUARIO], [ID_TIPO], [NOME], [EMAIL], [SENHA], [SALT], [ATIVO]) VALUES (93, 5, N'Ayrton Senna do Brasil', N'ayrton@vencedor.com', N'cae52d6e890f65c6d1f753f2ee684d6bf73ca303a7371d1888b647b0961c339ead7c7445b4b688c86651fe9163ee09e5cc69737d0a5fc9c17b6faf6be65b0825', N'26333', 1)
SET IDENTITY_INSERT [dbo].[USUARIO] OFF
SET ANSI_PADDING ON
GO
/****** Object:  Index [UK_USUARIO_EMAIL]    Script Date: 08/09/2020 14:54:52 ******/
IF NOT EXISTS (SELECT * FROM sys.indexes WHERE object_id = OBJECT_ID(N'[dbo].[USUARIO]') AND name = N'UK_USUARIO_EMAIL')
CREATE UNIQUE NONCLUSTERED INDEX [UK_USUARIO_EMAIL] ON [dbo].[USUARIO]
(
	[EMAIL] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON) ON [PRIMARY]
GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PERFIL_USUARIO_PERFIL]') AND parent_object_id = OBJECT_ID(N'[dbo].[PERFIL_USUARIO]'))
ALTER TABLE [dbo].[PERFIL_USUARIO]  WITH CHECK ADD  CONSTRAINT [FK_PERFIL_USUARIO_PERFIL] FOREIGN KEY([ID_PERFIL])
REFERENCES [dbo].[PERFIL] ([ID_PERFIL])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PERFIL_USUARIO_PERFIL]') AND parent_object_id = OBJECT_ID(N'[dbo].[PERFIL_USUARIO]'))
ALTER TABLE [dbo].[PERFIL_USUARIO] CHECK CONSTRAINT [FK_PERFIL_USUARIO_PERFIL]
GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PERFIL_USUARIO_USUARIO]') AND parent_object_id = OBJECT_ID(N'[dbo].[PERFIL_USUARIO]'))
ALTER TABLE [dbo].[PERFIL_USUARIO]  WITH CHECK ADD  CONSTRAINT [FK_PERFIL_USUARIO_USUARIO] FOREIGN KEY([ID_USUARIO])
REFERENCES [dbo].[USUARIO] ([ID_USUARIO])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_PERFIL_USUARIO_USUARIO]') AND parent_object_id = OBJECT_ID(N'[dbo].[PERFIL_USUARIO]'))
ALTER TABLE [dbo].[PERFIL_USUARIO] CHECK CONSTRAINT [FK_PERFIL_USUARIO_USUARIO]
GO
IF NOT EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_USUARIO_TIPO]') AND parent_object_id = OBJECT_ID(N'[dbo].[USUARIO]'))
ALTER TABLE [dbo].[USUARIO]  WITH CHECK ADD  CONSTRAINT [FK_USUARIO_TIPO] FOREIGN KEY([ID_TIPO])
REFERENCES [dbo].[TIPO] ([ID_TIPO])
GO
IF  EXISTS (SELECT * FROM sys.foreign_keys WHERE object_id = OBJECT_ID(N'[dbo].[FK_USUARIO_TIPO]') AND parent_object_id = OBJECT_ID(N'[dbo].[USUARIO]'))
ALTER TABLE [dbo].[USUARIO] CHECK CONSTRAINT [FK_USUARIO_TIPO]
GO
/****** Object:  StoredProcedure [dbo].[USUARIO_CONSULTAR]    Script Date: 08/09/2020 14:54:52 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
IF NOT EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[USUARIO_CONSULTAR]') AND type in (N'P', N'PC'))
BEGIN
EXEC dbo.sp_executesql @statement = N'CREATE PROCEDURE [dbo].[USUARIO_CONSULTAR] AS'
END
GO
ALTER PROCEDURE [dbo].[USUARIO_CONSULTAR]
	@ID_USUARIO
		int
	,@NOME
		varchar(200)
	,@QTD_RET
		int OUTPUT
AS
BEGIN
	SET NOCOUNT OFF;

/*
PROC DE TESTES
*/

	SELECT
		*
	FROM
		USUARIO (NOLOCK)
	WHERE
		ID_USUARIO = @ID_USUARIO OR NOME LIKE ('%' + @NOME + '%');

	SET
		@QTD_RET = @@ROWCOUNT;

	RETURN
		@QTD_RET;
END
GO
